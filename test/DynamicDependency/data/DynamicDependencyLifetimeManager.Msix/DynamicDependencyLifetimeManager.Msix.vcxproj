<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <Configuration>Debug</Configuration>
    <Platform>x64</Platform>
    <PlatformTarget>x64</PlatformTarget>
  </PropertyGroup>
  <!-- TODO: Replace relative pathing ..\build\ with $(something)\build -->
  <Import Project="..\..\..\..\build\EnsureOutputLayout.props" />
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>16.0</VCProjectVersion>
    <ProjectGuid>{a7391725-4ef5-438f-8de1-645423e46955}</ProjectGuid>
    <Keyword>Win32Proj</Keyword>
    <ProjectName>DynamicDependencyLifetimeManager.Msix</ProjectName>
  </PropertyGroup>
  <!-- <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" /> -->
  <PropertyGroup>
    <!-- <ConfigurationType>Makefile</ConfigurationType> -->
    <PlatformToolset>v142</PlatformToolset>
  </PropertyGroup>
  <!-- <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" /> -->
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <!-- <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" /> -->
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />

  <PropertyGroup>
    <!-- <ProjectDir>.\</ProjectDir> -->
    <ProjectDir Condition="'$(ProjectDir)' == ''">$(MSBuildProjectDirectory)\</ProjectDir>
    <!-- <SolutionDir>..\..\..\..\</SolutionDir> -->
    <SolutionDir Condition="'$(SolutionDir)' == ''">$(RepoRoot)\</SolutionDir>
  </PropertyGroup>


  <PropertyGroup>
    <NMakeBuildCommandLine>nmake /f makefile.mak ProjectDir=$(ProjectDir) SolutionDir=$(SolutionDir) OutDir=$(OutDir) TargetName=$(TargetName) Platform=$(Platform) WindowsAppSdkBuildPipeline=$(WindowsAppSdkBuildPipeline) </NMakeBuildCommandLine>
    <NMakeOutput>$(OutputPath)DynamicDependencyLifetimeManager.msix</NMakeOutput>
    <NMakeCleanCommandLine>nmake /f makefile.mak ProjectDir=$(ProjectDir) SolutionDir=$(SolutionDir) OutDir=$(OutDir) TargetName=$(TargetName) Platform=$(Platform) WindowsAppSdkBuildPipeline=$(WindowsAppSdkBuildPipeline) clean</NMakeCleanCommandLine>
    <NMakeReBuildCommandLine>nmake /f makefile.mak ProjectDir=$(ProjectDir) SolutionDir=$(SolutionDir) OutDir=$(OutDir) TargetName=$(TargetName) Platform=$(Platform) WindowsAppSdkBuildPipeline=$(WindowsAppSdkBuildPipeline) rebuild</NMakeReBuildCommandLine>
    <NMakePreprocessorDefinitions>_DEBUG;$(NMakePreprocessorDefinitions)</NMakePreprocessorDefinitions>
    <OutDir>$(OutDir)</OutDir>
    <IntDir>$(IntDir)</IntDir>
    <NMakeIncludeSearchPath>$(SolutionDir)tools</NMakeIncludeSearchPath>
  </PropertyGroup>
  <ItemDefinitionGroup>
  </ItemDefinitionGroup>
  <ItemGroup>
    <Xml Include="appxmanifest.xml" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\..\..\..\dev\DynamicDependencyLifetimeManager\DynamicDependencyLifetimeManager.ProxyStub\DynamicDependencyLifetimeManager.ProxyStub.vcxproj">
      <Project>{8c79c46d-1577-44ca-83df-88b74c3e4586}</Project>
    </ProjectReference>
    <ProjectReference Include="..\..\..\..\dev\DynamicDependencyLifetimeManager\DynamicDependencyLifetimeManager\DynamicDependencyLifetimeManager.vcxproj">
      <Project>{2e5bf0d2-78fa-4b60-a341-f65a0d58bd86}</Project>
    </ProjectReference>
  </ItemGroup>


  <PropertyGroup>
    <MakeMsixAssets>true</MakeMsixAssets>
  </PropertyGroup>
  <PropertyGroup>
    <PreNMakeBuildTarget>$(PostBuildDependsOn);MakeMSIX</PreNMakeBuildTarget>
    <TargetBasename>DynamicDependencyLifetimeManager</TargetBasename>

    <TargetExe>$(TargetBasename)</TargetExe>
    <TargetExeDir>$(OutDir)$(TargetExe)</TargetExeDir>
    <TargetExeFile>$(TargetExeDir)\$(TargetExe).exe</TargetExeFile>

    <TargetExeProxyStub>$(TargetBasename).ProxyStub</TargetExeProxyStub>
    <TargetExeProxyStubDir>$(OutDir)$(TargetExeProxyStub)</TargetExeProxyStubDir>
    <TargetExeProxyStubFile>$(TargetExeProxyStubDir)\$(TargetExeProxyStub).dll</TargetExeProxyStubFile>

    <DdlmShadow>DynamicDependencyLifetimeManagerShadow</DdlmShadow>
    <DdlmShadowExe>$(DdlmShadow)</DdlmShadowExe>
    <DdlmShadowExeDir>$(OutDir)$(DdlmShadowExe)</DdlmShadowExeDir>
    <DdlmShadowExeFile>$(DdlmShadowExeDir)\$(DdlmShadowExe).exe</DdlmShadowExeFile>
    <DdlmShadowExePdb>$(DdlmShadowExeDir)\$(DdlmShadowExe).pdb</DdlmShadowExePdb>

    <VersionInfoDir>$(ProjectDir)</VersionInfoDir>
    <VersionInfoFile>$(VersionInfoDir)Microsoft.WindowsAppRuntime.Release!4.1.0</VersionInfoFile>
  </PropertyGroup>
  <ItemGroup>
    <MakeMsixInputAssets Include="$(ProjectDir)\Assets\*" />
    <MakeMsixInputs Include="$(VersionInfoFile)" />
    <MakeMsixInputs Include="$(TargetExeFile)" />
    <MakeMsixInputs Include="$(TargetExeProxyStubFile)" />
    <MakeMsixInputs Include="$(DdlmShadowExeFile)" />
    <MakeMsixInputs Include="$(DdlmShadowExePdb)" />
  </ItemGroup>

  <Target Name="Build" DependsOnTargets="MakeMSIX">
    <Message Text="MakeMSIX 6:$(RepoRoot)" Importance="high" />
    <Message Text="MakeMSIX 6:$(ProjectDir)" Importance="high" />
    <Message Text="MakeMSIX 6:$(SolutionDir)" Importance="high" />
  </Target>


  <!-- <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" /> -->

  <!-- <Import Project="$(RepoRoot)\build\EnsureOutputLayout.props" /> -->
  <!-- <Import Project="$(ProjectDir)\MakeMsix.targets" /> -->
  <Import Project="MakeMsix.targets" />

  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
