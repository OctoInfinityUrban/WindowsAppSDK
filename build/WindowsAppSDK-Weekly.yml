# https://aka.ms/yaml
name: $(BuildDefinitionName)_$(date:yyMM).$(date:dd)$(rev:rrr)
variables:
- template: WindowsAppSDK-Versions.yml
- template: WindowsAppSDK-CommonVariables.yml
- name: buildPool
  value: 'ProjectReunionESPool-2022'

parameters:
  - name: "ReleaseSigning"
    type: boolean
    default: False
  - name: "IgnoreFailures"
    type: boolean
    default: False
  - name: "PublishPackage"
    type: boolean
    default: False
  - name: "GenerateSBOM"
    type: boolean
    default: False
  # A main goal of this pipeline is to run time-consuming static analysis, such as PREFast, weekly;
  # hence the following 2 paramters default to true.
  - name: "RunSDLBinaryAnalysis"
    displayName: "Run SDL's Binary Analysis (PREFast, BinSkim)"
    type: boolean
    default: true
  - name: "enablePREFast"
    type: boolean
    default: true
  - name: "enableLicenseInstall"
    type: boolean
    default: true

resources:
  repositories:
  - repository: templates_onebranch
    type: git
    name: OneBranch.Pipelines/GovernedTemplates
    ref: refs/heads/main

jobs:
- template: AzurePipelinesTemplates\WindowsAppSDK-BuildFoundation-job.yml
  parameters:
    ReleaseSigning: ${{parameters.ReleaseSigning}}
    IgnoreFailures: ${{parameters.IgnoreFailures}}
    PublishPackage: ${{parameters.PublishPackage}}
    GenerateSBOM: ${{parameters.GenerateSBOM}}
    RunSDLBinaryAnalysis: ${{parameters.RunSDLBinaryAnalysis}}
    enablePREFast: ${{parameters.enablePREFast}}
    enableLicenseInstall: ${{parameters.enableLicenseInstall}}
    isWeeklyRun: True
